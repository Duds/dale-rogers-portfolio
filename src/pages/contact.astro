---
import Layout from "@/layouts/Layout.astro";
import Icon from "@/components/ui/Icon.astro";
import Button from "@/components/ui/Button.astro";
---

<Layout title="Contact">
  <div class="container mx-auto px-4 py-8">
    <h1 class="font-display text-4xl text-text mb-6">Get in Touch</h1>

    <div class="grid md:grid-cols-2 gap-8">
      <div>
        <p class="text-text-secondary mb-6">
          Interested in working together? Have a question about service design?
          I'd love to hear from you.
        </p>

        <div class="space-y-4 mb-8">
          <div class="flex items-center space-x-4">
            <Icon name="mail" class="w-6 h-6 text-primary" />
            <a
              id="contact-email"
              href="#"
              class="text-text hover:text-primary transition-colors"
            >
              [emailÂ protected]
            </a>
          </div>
          <div class="flex items-center space-x-4">
            <Icon name="linkedin" class="w-6 h-6 text-primary" />
            <a
              href="https://linkedin.com/in/dale-rogers"
              class="text-text hover:text-primary transition-colors"
              target="_blank"
              rel="noopener noreferrer"
            >
              linkedin.com/in/dale-rogers
            </a>
          </div>
        </div>

        <Button id="contact-email-button" href="#" variant="primary">
          Send an Email
        </Button>

        <script is:inline>
          document.addEventListener("DOMContentLoaded", () => {
            const encodedEmail = "aGVsbG9AZGFsZXJvZ2Vycy5jb20uYXU=";
            const email = atob(encodedEmail);
            const emailLink = document.getElementById("contact-email");
            if (emailLink) {
              emailLink.href = "mailto:" + email;
              emailLink.textContent = email;
            }
            const emailButton = document.getElementById("contact-email-button");
            if (emailButton) {
              emailButton.href = "mailto:" + email;
            }
          });
        </script>
      </div>

      <div class="bg-secondary p-6 rounded-card">
        <h2 class="font-display text-2xl text-text mb-4">Location</h2>
        <p class="text-text-secondary mb-4">
          Based in Canberra, Australia<br />
          Available for remote work worldwide
        </p>
        <p class="text-text-secondary">
          I work with clients across various sectors, including government,
          education, and private organizations.
        </p>
      </div>
    </div>

    <section class="mt-12">
      <h2 class="text-3xl font-display mb-4">Send a Message</h2>
      <form
        method="POST"
        action="/api/contact"
        class="space-y-4"
        id="contact-form"
      >
        <div>
          <label for="name" class="block text-text mb-1">Name</label>
          <input
            type="text"
            id="name"
            name="name"
            class="w-full px-4 py-2 border rounded"
            required
          />
        </div>
        <div>
          <label for="email" class="block text-text mb-1">Email</label>
          <input
            type="email"
            id="email"
            name="email"
            class="w-full px-4 py-2 border rounded"
            required
          />
        </div>
        <div>
          <label for="message" class="block text-text mb-1">Message</label>
          <textarea
            id="message"
            name="message"
            rows="5"
            class="w-full px-4 py-2 border rounded"
            required></textarea>
        </div>
        <div id="form-message" class="hidden"></div>
        <Button type="submit" variant="primary"> Send Message </Button>
      </form>

      <script>
        document
          .getElementById("contact-form")
          ?.addEventListener("submit", async (e) => {
            e.preventDefault();
            const form = e.target as HTMLFormElement;
            const formMessage = document.getElementById("form-message");

            try {
              const response = await fetch(form.action, {
                method: "POST",
                body: new FormData(form),
              });

              const data = await response.json();

              if (formMessage) {
                formMessage.classList.remove("hidden");
                if (response.ok) {
                  formMessage.textContent = "Message sent successfully!";
                  formMessage.className = "text-green-600";
                  form.reset();
                } else {
                  formMessage.textContent =
                    data.error || "Failed to send message. Please try again.";
                  formMessage.className = "text-red-600";
                }
              }
            } catch (error) {
              if (formMessage) {
                formMessage.classList.remove("hidden");
                formMessage.textContent =
                  "An error occurred. Please try again.";
                formMessage.className = "text-red-600";
              }
            }
          });
      </script>
    </section>
  </div>
</Layout>
