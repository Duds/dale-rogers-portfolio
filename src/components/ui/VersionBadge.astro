---
/**
 * Version Badge Component
 * Displays version information and deployment environment
 * @component VersionBadge
 * @example
 * ```astro
 * <VersionBadge />
 * ```
 */
import '@/styles/components/version-badge.css';

interface Props {
  /** Custom class names */
  class?: string;
}

const { class: className } = Astro.props;

// Get version from package.json (this will be replaced at build time)
const version = '1.0.5';

// Determine environment at build time
const isDev = import.meta.env.DEV;
const hostname = Astro.url.hostname;

// More robust environment detection
const isPreview = hostname.includes('preview') || hostname.includes('preview.westeurope');
const isProduction =
  hostname.includes('wonderful-pond-07724bc03.1.azurestaticapps.net') &&
  !hostname.includes('preview');

// Use ASTRO_ENVIRONMENT as fallback if hostname detection fails
const astroEnv = import.meta.env.ASTRO_ENVIRONMENT;

// Debug logging for environment detection
console.log('üîç VersionBadge Environment Detection:', {
  hostname,
  isDev,
  isPreview,
  isProduction,
  ASTRO_ENVIRONMENT: astroEnv,
});

// Environment detection with fallback to ASTRO_ENVIRONMENT
let environment = 'unknown';
if (isDev) {
  environment = 'dev';
} else if (isPreview) {
  environment = 'preview';
} else if (isProduction) {
  environment = 'prod';
} else if (astroEnv) {
  // Fallback to build-time environment variable
  environment = astroEnv === 'production' ? 'prod' : astroEnv;
}
const environmentClass =
  environment === 'dev'
    ? 'env-dev'
    : environment === 'preview'
      ? 'env-preview'
      : environment === 'prod'
        ? 'env-prod'
        : 'env-unknown';

// Get additional build info if available
const commitHash = import.meta.env.ASTRO_COMMIT_HASH || 'local';
const branch = import.meta.env.ASTRO_BRANCH || (isDev ? 'dev' : isPreview ? 'preview' : 'main');
---

<div
  class={`version-badge ${environmentClass} ${className || ''}`}
  title={`Branch: ${branch} | Commit: ${commitHash}`}
>
  <span class="version-badge__version">v{version}</span>
  <span class="version-badge__environment">{environment}</span>
</div>
